<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<!-- Create a new terraform workspace `dev` and select it-->
	<Target Name="CREATE_TERRAFORM_WORKSPACE_DEV">
		<Exec Command="terraform workspace new dev" WorkingDirectory="$(SolutionDir)" IgnoreExitCode="true" />
		<Exec Command="terraform workspace select dev" WorkingDirectory="$(SolutionDir)" />
		<Message Text="==> DONE"/>
	</Target>

	<!-- Init terraform -->
	<Target Name="TF_INIT" >
		<Exec Command='powershell -ExecutionPolicy Bypass -File ".\.set-secrets.ps1"' WorkingDirectory="$(UserProfile)" />
		<Exec Command="terraform init" WorkingDirectory="$(TerraformFolder)" />
		<Message Text="==> DONE"/>
	</Target>

	<!-- terraform plan -->
	<Target Name="TF_PLAN" DependsOnTargets="TF_INIT">
		<Exec Command='terraform plan -out=tfplan' WorkingDirectory="$(TerraformFolder)" />
		<Message Text="==> DONE"/>
	</Target>

	<!-- terraform apply -->
	<Target Name="TF_APPLY" DependsOnTargets="TF_PLAN">
		<Exec Command='terraform apply -auto-approve tfplan' WorkingDirectory="$(TerraformFolder)" />
		<Message Text="==> DONE"/>
	</Target>


	<!-- terraform destroy-->
	<Target Name="TF_DESTROY">
		<Exec Command="terraform destroy -auto-approve" WorkingDirectory="$(SolutionDir)" />
		<Message Text="==> DONE"/>
	</Target>


</Project>
