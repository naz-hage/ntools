# Version Automation Guide

This document outlines the automation solutions implemented to keep the `docs/ntools/ntools.md` file synchronized with version information from JSON configuration files in the `dev-setup/` directory.

The ntools project maintains tool version information in two places:
1. **JSON Configuration Files** (`dev-setup/*.json`) - Used for automated installation
2. **Documentation Table** (`docs/ntools/ntools.md`) - User-facing version reference

Previously, these had to be updated manually, leading to inconsistencies and outdated documentation.

## Solutions Implemented

---

## 1. PowerShell Script Automation

- **File**: `dev-setup/update-versions.ps1`
- **Purpose**: Standalone script to sync versions between JSON files and documentation
- **Execution**: Manual or triggered by other automation

### Features
- Reads all JSON files in `dev-setup/` directory
- Extracts `Name` and `Version` from `NbuildAppList[0]`
- Updates corresponding entries in `ntools.md` table
- Handles tool name mapping (e.g., "PowerShell" ↔ "Powershell")
- Updates "Last Checked on" dates automatically
- Provides colored console output for better UX

## Version Automation Approach
### Usage
```powershell
# Basic usage
cd dev-setup
.\update-versions.ps1

# With custom paths
.\update-versions.ps1 -DevSetupPath "C:\source\ntools\dev-setup" -DocsPath "C:\source\ntools\docs\ntools\ntools.md"
```

---

Tool versions in documentation are updated using the MSBuild task (`UpdateVersionsInDocs`) via the `nb update_doc_versions` command. This extracts all tool/version pairs from every `NbuildAppList` entry in every `*.json` file in `dev-setup` and updates the documentation table accordingly. See the documentation in `ntools.md` for details.

## 2. NBuild Task Integration

- **File**: `NbuildTasks/UpdateVersionsInDocs.cs`
- **Purpose**: MSBuild task for build-time automation
- **Execution**: Integrated into your existing NBuild workflow

### Features
- Native C# MSBuild task implementation
- JSON parsing using `System.Text.Json`
- Regex-based markdown table updating
- Comprehensive tool name mapping logic
- Build-time logging and error handling
- Can be part of CI/CD pipeline

### Usage
```xml
<Target Name="UpdateDocVersions">
  <UpdateVersionsInDocs 
    DevSetupPath="$(MSBuildProjectDirectory)\dev-setup" 
    DocsPath="$(MSBuildProjectDirectory)\docs\ntools\ntools.md" />
</Target>
```

---

## 3. Git Pre-commit Hooks


The pre-commit system in this project uses the [pre-commit framework](https://pre-commit.com/) to automate checks and updates before every commit. Here’s how it works:

1. **Configuration**: All hooks are defined in `.pre-commit-config.yaml`. This file specifies which checks to run, including built-in checks (YAML/JSON validation, trailing whitespace, etc.), code formatting, and custom scripts.
2. **Installation**: Developers run `pre-commit install` once to set up the Git hook. This creates a `.git/hooks/pre-commit` script that calls the pre-commit framework.
3. **Trigger**: Every time you run `git commit`, the pre-commit framework automatically runs all enabled hooks on the files being committed.
4. **Custom Version Update Hook**: A custom hook (`update-doc-versions`) is defined to run the PowerShell script `dev-setup/update-versions.ps1` whenever any `dev-setup/*.json` file is staged for commit. This ensures that `docs/ntools/ntools.md` is always updated with the latest tool versions before the commit is finalized.
5. **Chaining and Enforcement**: If any hook fails (e.g., code formatting, version update, or validation), the commit is blocked until the issues are resolved. This enforces code and documentation quality across all contributors.

**Diagram:**

```
git commit
   │
   ▼
pre-commit (framework)
   │
   ├─ built-in hooks (YAML/JSON, formatting, etc.)
   ├─ custom: update-doc-versions (runs update-versions.ps1)
   │      └─ updates docs/ntools/ntools.md if needed
   └─ other hooks (commit message, etc.)
   │
   ▼
commit proceeds if all hooks pass
```

**Key Files:**
- `.pre-commit-config.yaml`: Hook definitions and configuration
- `dev-setup/update-versions.ps1`: Script called by the custom hook
- `.git/hooks/pre-commit`: Auto-generated by pre-commit, delegates to the framework

**Benefits:**
- Ensures documentation and code quality before every commit
- Catches issues early in the developer workflow
- Automates repetitive tasks and reduces human error


#### Manual Hook Features:
- Detects JSON file changes in staging area
- Runs PowerShell version update script
- Automatically stages updated documentation
- Additional quality checks (debugging code, large files, JSON validation)
- Colored output with status indicators
- C# code formatting integration

#### Pre-commit Framework Features:
- Comprehensive hook ecosystem
- JSON/YAML validation
- Code formatting (C#, PowerShell)
- Conventional commit message validation
- Configurable and extensible
- Performance optimized

### Usage
```bash
# Manual setup
chmod +x .git/hooks/pre-commit

# Framework setup
pip install pre-commit
pre-commit install
pre-commit install --hook-type commit-msg

# Normal git workflow - hooks run automatically
git add .
git commit -m "Update PowerShell version"
```

---
## 4. Tool Name Mapping

The automation handles differences between JSON configuration names and documentation display names:

| Documentation Name | JSON Configuration Name |
|-------------------|------------------------|
| Node.js | Node.js |
| PowerShell | Powershell |
| Python | Python |
| Git for Windows | Git for Windows |
| Visual Studio Code | Visual Studio Code |
| NuGet | Nuget |
| Terraform | Terraform |
| Terraform Lint | terraform lint |
| kubernetes | kubectl |
| minikube | minikube |
| Azure CLI | AzureCLI |
| MongoDB Community Server | MongoDB |
| pnpm | pnpm |
| Ntools | Ntools |
