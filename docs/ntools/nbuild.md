- [Usage](#usage)
- [nbuild.targets](#nbuildtargets)
- [common.targets](#commontargets)
- [Examples](#examples)

`Nbuild` (`Nb`) is a tool that launches MSBuild with a target to build.

- Nb.exe is a command line tool that installs the development tools and runtimes required to build and test the solution. It is a wrapper for MSBuild and provides a simplified interface for building solutions. It also provides a way to define and run custom targets.
  - To run a target type `Nb.exe [Target Name]`
  - The list of targets is generated by running `Nb.exe -c targets` command.

**Expects:**
- `nbuild.targets` file in the solution folder.
- `common.targets` file in `$(ProgramFiles)\Nbuild`.

**Generates:**

- `nbuild.bat` used to run MSBuild to build any target defined in `*.targets` files.

There are multiple targets files included in the `NTools` repository. Here is a list of all [targets](nbuild-targets.md) which are defined in `*.targets` files.

### Usage
```cmd
 Nb.exe [-c value] [-json value] [-v value]
  - c    : Specifies the command to execute. Possible values: targets, install, uninstall, download, list.
         targets         -> Lists available targets and saves them in the targets.md file.
         install         -> Downloads and installs apps specified in the -json option.
         uninstall       -> Uninstalls apps specified in the -json option.
         download        -> Downloads apps specified in the -json option.
         list            -> Lists apps specified in the -json option.
         ----
         - By default, the -json option points to the `NTools` deployment folder: $(ProgramFiles)\build\tools.json.
         - The install, uninstall, and download commands require admin privileges to run. (string, default=)
  - json : Specifies the JSON file that holds the list of apps. Only valid for the install, download, and list commands.
         Sample JSON file: https://github.com/naz-hage/`NTools`/blob/main/DevSetup//app-`NTools`.json
          (string, default=$(ProgramFiles)\nbuild\`NTools`.json)
  - v    : Optional parameter which sets the console output verbose level
         ----
         - if no command line options are specified with the -v option , i.e.: 'Nb.exe staging -v true`
           `Nb` will run an MSbuild target `staging` defined in a `nbuild.targets` file which present in the solution folder.
           Run `Nb.exe -t Targets` to list the available targets.
         -v Possible Values: (true or false, default=False)
```


**If the -json option is not specified, the default json file `$(ProgramFiles)\Nbuild\`NTools`.json` is used if it exists**. 


### nbuild.targets
- `nbuild.targets` is a MSBuild file that imports `common.targets`.
- The following properties are required in `nbuild.targets`:
    - SolutionName: The name of the solution file.
```xml
<PropertyGroup>
  <!--The GUID should be replaced with the solution name-->
  <SolutionName>$([System.IO.Path]::GetFileNameWithoutExtension('$(MSBuildProjectDirectory)'))</SolutionName>
  <DeploymentFolder>$(ProgramFiles)\Nbuild</DeploymentFolder>
</PropertyGroup>
```

- The following target is required in `nbuild.targets`:
    - ARTIFACTS: The folder where the artifacts are copied to.
```xml
<Target Name="ARTIFACTS" DependsOnTargets="TAG">
<!--The folder where the artifacts are copied to-->
<ItemGroup>
    <BinaryFiles Include="$(Solut
```
                    
### common.targets
- `common.targets` is imported by `nbuild.targets`.

- Common TARGETS:

| **Target Name** | **Description** |
| --- | --- |
| PROPERTIES          | Common properties that will be used by all targets |
| CLEAN               | Clean up the project and artifacts folder |
| INSTALL_DEP         | Install dependencies |
| TELEMETRY_OPT_OUT   | Opt out of the DOTNET_CLI_TELEMETRY_OPTOUT - move to common |
| STAGING             | Create a staging package for testing |
| PRODUCTION          | Create a production package for release |
| STAGING_DEPLOY      | Create a staging package and deploy for testing |
| PRODUCTION_DEPLOY   | Create a production package and deploy for release |
| SOLUTION            | Build the solution Release configuration  using dotnet build |
| SOLUTION_MSBUILD    | Build the solution Release configuration  using MSBuild |
| PACKAGE             | Create a packahe for the solution default is a zip file of all artifacts |
| COPY_ARTIFACTS      | Save the artifacts to the artifacts folder |
| DEPLOY              | Deploy the package. default is to extract artifacts into DeploymentProperty folder |
| TEST                | Run all tests using dotnet test in Release mode |
| TEST_DEBUG          | Run all tests using dotnet test in Debug mode |
| IS_ADMIN            | Check if current process is running in admin mode AdminCheckExitCode property is set |
| SingleProject       | Example how to build a single project |
| HandleError         | Error handling placeholder |

