- [Usage](#usage)
- [nbuild.targets](#nbuildtargets)
- [common.targets](#commontargets)
- [Examples](#examples)
---

# Nbuild

 - `Nbuild` (`nb.exe`) is a wrapper for [MSBuild](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild) that simplifies building solutions and provides a way to define and run custom targets.
 - `Nb.exe` is also a command line tool that installs the development tools and run times required to build and test any solution.
       - To build a target type `Nb.exe [Target Name]`
      - The list of targets is generated by running the `Nb.exe targets` command.
  - `Nb.exe` expects the [nbuild.targets](#nbuildtargets) file to be present in the solution folder.

Below is a full list of options that can be used with `Nb.exe`:
### Usage
```cmd
Description:
  Nbuild - Build and DevOps Utility

Usage:
  nb [command] [options]

Options:
  --version       Show version information
  -?, -h, --help  Show help and usage information

Commands:
  install             Install tools from JSON
  uninstall           Uninstall tools from JSON
  list                Display a formatted table of all tools and their
                      versions.
                      Use this command to audit, compare, or document the
                      state of your development environment.
  download            Download tools from JSON
  path                Display path segments
  git_info            Display git info
  git_settag          Set git tag
  git_autotag         Set git autotag
  git_push_autotag    Push git autotag
  git_branch          Display git branch
  git_clone           Clone git repository
  git_deletetag       Delete git tag
  release_create      Create release
  pre_release_create  Create pre-release
  release_download    Download release asset
  list_release        List releases
  targets             Display build targets
```

**If the -json option is not specified, the default json file `$(ProgramFiles)\Nbuild\NTools.json` is used**. 

### nbuild.targets
See [nbuild.targets](../setup.md#nbuildtargets) for more information on how to create a `nbuild.targets` file.
                    
### common.targets
- The `common.targets` file includes all the defaults targets needed to build, test and deploy a solution.  The `common.targets` file is located in the `$(ProgramFiles)\Nbuild` folder.  The `nbuild.targets` file in the solution folder imports the `common.targets` file

Below is list of common targets that are defined in the `common.targets` file

| **Target Name** | **Description** |
| --- | --- |
| PROPERTIES          | Common properties that will be used by all targets |
| CLEAN               | Clean up the project and artifacts folder |
| INSTALL_DEP         | Install dependencies |
| TELEMETRY_OPT_OUT   | Opt out of the DOTNET_CLI_TELEMETRY_OPTOUT - move to common |
| STAGE             | Create a stage package for testing |
| PROD          | Create a production package for release |
| STAGE_DEPLOY      | Create a stage package and deploy for testing |
| PROD_DEPLOY   | Create a production package and deploy for release |
| SOLUTION            | Build the solution Release configuration  using dotnet build |
| SOLUTION_MSBUILD    | Build the solution Release configuration  using MSBuild |
| PACKAGE             | Create a package for the solution default is a zip file of all artifacts |
| COPY_ARTIFACTS      | Save the artifacts to the artifacts folder |
| DEPLOY              | Deploy the package. default is to extract artifacts into DeploymentProperty folder |
| TEST                | Run all tests using dotnet test in Release mode |
| TEST_DEBUG          | Run all tests using dotnet test in Debug mode |
| IS_ADMIN            | Check if current process is running in admin mode AdminCheckExitCode property is set |
| SingleProject       | Example how to build a single project |
| HandleError         | Error handling placeholder |

### Examples

This section provides examples of how to use the `nb.exe` command line tool. The examples assume that you are running a powershell terminal.

#### List Command Details
The `list` command displays a formatted table of all tools and their versions. Use this command to audit, compare, or document the state of your development environment.

**Usage:**
```cmd
nb list [options]
```

**Options:**
- `--json <json>` - Full path to the manifest file containing your tool definitions. If the path contains spaces, use double quotes. Default: `"C:\Program Files\NBuild\ntools.json"`
- `-?, -h, --help` - Show help and usage information

**Examples:**
```cmd
# Use default manifest file
nb.exe list

# Use custom manifest file
nb.exe list --json "C:\MyTools\custom-tools.json"

# Show help for list command
nb.exe list --help
```

## 1. List Installed Applications
```cmd
nb.exe list --json "C:\Program Files\NBuild\ntools.json"
```
Lists all applications specified in the provided JSON file. If no `--json` option is specified, the default file `C:\Program Files\NBuild\ntools.json` is used.

## 2. Download Applications
```cmd
nb.exe download --json "C:\Program Files\NBuild\ntools.json"
```
Download tools and applications specified in the manifest file containing your tool definitions. Provide the full path using `--json` option. If the path contains spaces, use double quotes.

## 3. Install Applications
```cmd
nb.exe install --json "C:\Program Files\tools.json"
```
Downloads and installs applications specified in the JSON file (requires admin privileges). If the application is already installed, it will skip the installation.

## 4. Display Git Information
```cmd
nb.exe git_info
```
Displays the current Git branch and tag information for the local repository.

## 5. Run a Build Target
```cmd
nb.exe stage -v true
```
Runs the `stage` target defined in the nbuild.targets file with verbose output enabled.

## 6. List nbuild targets
```cmd
nb.exe targets
```
Lists all available build targets defined in the nbuild.targets file and saves them in the targets.md file.

## 7. Set a Specific Git Tag
```cmd
nb.exe git_settag -tag 1.0.0
```
Sets the specified Git tag (`1.0.0`) in the local repository.

## 8. Automatically Set the Next Git Tag
```cmd
nb.exe git_autotag -buildtype stage
```
Automatically generates and sets the next Git tag based on the specified build type (`stage` or `prod`).

## 9. Push the Next Git Tag to Remote
```cmd
nb.exe git_push_autotag -buildtype prod
```
Automatically generates the next Git tag based on the specified build type (`prod`) and pushes it to the remote repository.

## 10. Display the Current Git Branch
```cmd
nb.exe git_branch
```
Displays the current Git branch in the local repository.

## 11. Clone a Git Repository
```cmd
nb.exe git_clone -url https://github.com/example/repo -path C:\Projects
```
Clones the specified Git repository (`https://github.com/example/repo`) into the specified path (`C:\Projects`).

## 12. Delete a Specific Tag
```cmd
nb.exe git_deletetag -tag 1.0.0 -v true
```

## 13. Creating a Release
To create a release for the repository `my-repo` with the tag `1.0.0`, branch `main`, and an asset located at `C:\Releases\1.0.0.zip`, you would use the following command:

```batch
nb.exe release_create -repo userName/my-repo -tag 1.0.0 -branch main -file C:\Releases\1.1.0.zip
```

## 14. Creating a Pre-Release
To create a pre-release for the repository `my-repo` with the tag `1.0.0`, branch `main`, and an asset located at `C:\Releases\1.0.0.zip`, you would use the following command:

```batch
nb.exe pre_release_create -repo userName/my-repo -tag 1.0.0 -branch main -file C:\Releases\1.1.0.zip
```

## 15. Downloading an Asset
To download an asset from the release with the tag `1.0.0` in the repository `my-repo` to the path `C:\Downloads`:

```batch
nb.exe release_download -repo userName/my-repo -tag 1.0.0 -path C:\Downloads
```
An asset named 1.0.0.zip will be downloaded to the specified path if it exists in the release.

## 16. Creating a Release with Full GitHub URL
To create a release for the repository `my-repo` with the tag `1.0.0`, branch `main`, and an asset located at `C:\Releases\1.0.0.zip`, using the full GitHub URL:

```batch
nb.exe release_create -repo https://github.com/userName/my-repo -tag 1.0.0 -branch main -file C:\Releases\1.0.0.zip
```

## 17. Downloading an Asset with Full GitHub URL
To download an asset from the release with the tag `1.0.0` in the repository `my-repo` to the path `C:\Downloads`, using the full GitHub URL:

```batch
nb.exe release_download -repo https://github.com/userName/my-repo -tag 1.0.0 -path C:\Downloads
```
An asset named `1.0.0.zip` will be downloaded to the specified path if it exists in the release.

## 18. Getting latest 3 releases and the newest pre-release (if newer than the latest release)

```batch
nb.exe list_release -repo https://github.com/userName/my-repo
```
