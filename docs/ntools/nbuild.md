- [Usage](#usage)
- [nbuild.targets](#nbuildtargets)
- [common.targets](#commontargets)
- [Examples](../usage.md)
---

# Nbuild

 - `Nbuild` (`nb.exe`) is a wrapper for [MSBuild](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild) that simplifies building solutions and provides a way to define and run custom targets.
 - `Nb.exe` is also a command line tool that installs the development tools and run times required to build and test any solution.
       - To build a target type `Nb.exe [Target Name]`
      - The list of targets is generated by running the `Nb.exe targets` command.
  - `Nb.exe` expects the [nbuild.targets](#nbuildtargets) file to be present in the solution folder.

Below is a full list of options that can be used with `Nb.exe`:
### Usage
```cmd
  Nb.exe command [-json value] [-v value]
  - command : Specifies the command to execute.
         list            -> Lists apps specified in the -json option.
         install         -> Downloads and installs apps specified in the -json option (require admin privileges to run).
         uninstall       -> Uninstalls apps specified in the -json option (require admin privileges to run).
         download        -> Downloads apps specified in the -json option (require admin privileges to run).
         targets         -> Lists available targets and saves them in the targets.md file.
         path            -> Displays environment path in local machine.
         git_info        -> Displays the current git information in the local repository.
         git_settag      -> Set specified tag with -tag option
         ----
 (one of list,install,uninstall,download,targets,path,git_info,git_settag, required)
  - json    : Specifies the JSON file that holds the list of apps. Only valid for the install, download, and list commands.
         - By default, the -json option points to the ntools deployment folder: $(ProgramFiles)\build\ntools.json.
         Sample JSON file: https://github.com/naz-hage/ntools/blob/main/dev-setup/ntools.json
          (string, default=$(ProgramFiles)\nbuild\ntools.json)
  - v       : Optional parameter which sets the console output verbose level
         ----
         - if no command line options are specified with the -v option , i.e.: 'Nb.exe stage -v true`
           `Nb` will run an MSbuild target `stage` defined in a `nbuild.targets` file which present in the solution folder.
           Run `Nb.exe Targets` to list the available targets.
         -v Possible Values: (true or false, default=False)
  - tag     : Specifies the tag used for the git_settag command. (string, default=)
```

**If the -json option is not specified, the default json file `$(ProgramFiles)\Nbuild\NTools.json` is used**. 

### nbuild.targets
See [nbuild.targets](../setup.md#nbuildtargets) for more information on how to create a `nbuild.targets` file.
                    
### common.targets
- The `common.targets` file includes all the defaults targets needed to build, test and deploy a solution.  The `common.targets` file is located in the `$(ProgramFiles)\Nbuild` folder.  The `nbuild.targets` file in the solution folder imports the `common.targets` file

Below is list of common targets that are defined in the `common.targets` file

| **Target Name** | **Description** |
| --- | --- |
| PROPERTIES          | Common properties that will be used by all targets |
| CLEAN               | Clean up the project and artifacts folder |
| INSTALL_DEP         | Install dependencies |
| TELEMETRY_OPT_OUT   | Opt out of the DOTNET_CLI_TELEMETRY_OPTOUT - move to common |
| STAGE             | Create a stage package for testing |
| PROD          | Create a production package for release |
| STAGE_DEPLOY      | Create a stage package and deploy for testing |
| PROD_DEPLOY   | Create a production package and deploy for release |
| SOLUTION            | Build the solution Release configuration  using dotnet build |
| SOLUTION_MSBUILD    | Build the solution Release configuration  using MSBuild |
| PACKAGE             | Create a package for the solution default is a zip file of all artifacts |
| COPY_ARTIFACTS      | Save the artifacts to the artifacts folder |
| DEPLOY              | Deploy the package. default is to extract artifacts into DeploymentProperty folder |
| TEST                | Run all tests using dotnet test in Release mode |
| TEST_DEBUG          | Run all tests using dotnet test in Debug mode |
| IS_ADMIN            | Check if current process is running in admin mode AdminCheckExitCode property is set |
| SingleProject       | Example how to build a single project |
| HandleError         | Error handling placeholder |

