- [Usage](#usage)
- [nbuild.targets](#nbuildtargets)
- [common.targets](#commontargets)
- [Examples](#examples)
---

# Nbuild

 - `Nbuild` (`nb.exe`) is a wrapper for [MSBuild](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild) that simplifies building solutions and provides a way to define and run custom targets.
 - `Nb.exe` is also a command line tool that installs the development tools and run times required to build and test any solution.
       - To build a target type `Nb.exe [Target Name]`
      - The list of targets is generated by running the `Nb.exe targets` command.
  - `Nb.exe` expects the [nbuild.targets](#nbuildtargets) file to be present in the solution folder.

Below is a full list of options that can be used with `Nb.exe`:
### Usage
```cmd
 Nb.exe command [-json value] [-v value] [-tag value] [-buildtype value]
  - command   : Specifies the command to execute.
         list                    -> Lists apps specified in the -json option.
         install                 -> Downloads and installs apps specified in the -json option (require admin privileges to run).
         uninstall               -> Uninstalls apps specified in the -json option (require admin privileges to run).
         download                -> Downloads apps specified in the -json option (require admin privileges to run).
         targets                 -> Lists available targets and saves them in the targets.md file.
         path                    -> Displays environment path in local machine.
         git_info                -> Displays the current git information in the local repository.
         git_settag              -> Set specified tag with -tag option
         git_autotag             -> Set next tag based on the build type: stage | prod
         git_push_autotag        -> Set next tag based on the build type and push to remote repo
         git_branch              -> Displays the current git branch in the local repository
         git_clone               -> Clone specified Git repo in the -url option
         ----
 (one of list,install,uninstall,download,targets,path,git_info,git_settag,git_autotag,git_push_autotag,git_branch,git_clone, required)
  - json      : Specifies the JSON file that holds the list of apps. Only valid for the install, download, and list commands.
         - By default, the -json option points to the ntools deployment folder: $(ProgramFiles)\build\ntools.json.
         Sample JSON file: https://github.com/naz-hage/ntools/blob/main/dev-setup/ntools.json
          (string, default=$(ProgramFiles)\nbuild\ntools.json)
  - v         : Optional parameter which sets the console output verbose level
         ----
         - if no command line options are specified with the -v option , i.e.: 'Nb.exe stage -v true`
           `Nb` will run an MSbuild target `stage` defined in a `nbuild.targets` file which present in the solution folder.
           Run `Nb.exe Targets` to list the available targets.
         -v Possible Values: (true or false, default=False)
  - tag       : Specifies the tag used for git_settag command. (string, default=)
  - path      : Specifies the path used for git_clone command. If not specified, the current directory will be used. (string, default=)
  - buildtype : Specifies the build type used for git_autotag and git_push_autotag commands. Possible values: stage, prod. (string, default=)
  - url       : Specifies the Git repository URL used for git_clone command. (string, default=)
```

**If the -json option is not specified, the default json file `$(ProgramFiles)\Nbuild\NTools.json` is used**. 

### nbuild.targets
See [nbuild.targets](../setup.md#nbuildtargets) for more information on how to create a `nbuild.targets` file.
                    
### common.targets
- The `common.targets` file includes all the defaults targets needed to build, test and deploy a solution.  The `common.targets` file is located in the `$(ProgramFiles)\Nbuild` folder.  The `nbuild.targets` file in the solution folder imports the `common.targets` file

Below is list of common targets that are defined in the `common.targets` file

| **Target Name** | **Description** |
| --- | --- |
| PROPERTIES          | Common properties that will be used by all targets |
| CLEAN               | Clean up the project and artifacts folder |
| INSTALL_DEP         | Install dependencies |
| TELEMETRY_OPT_OUT   | Opt out of the DOTNET_CLI_TELEMETRY_OPTOUT - move to common |
| STAGE             | Create a stage package for testing |
| PROD          | Create a production package for release |
| STAGE_DEPLOY      | Create a stage package and deploy for testing |
| PROD_DEPLOY   | Create a production package and deploy for release |
| SOLUTION            | Build the solution Release configuration  using dotnet build |
| SOLUTION_MSBUILD    | Build the solution Release configuration  using MSBuild |
| PACKAGE             | Create a package for the solution default is a zip file of all artifacts |
| COPY_ARTIFACTS      | Save the artifacts to the artifacts folder |
| DEPLOY              | Deploy the package. default is to extract artifacts into DeploymentProperty folder |
| TEST                | Run all tests using dotnet test in Release mode |
| TEST_DEBUG          | Run all tests using dotnet test in Debug mode |
| IS_ADMIN            | Check if current process is running in admin mode AdminCheckExitCode property is set |
| SingleProject       | Example how to build a single project |
| HandleError         | Error handling placeholder |

### Examples

This section provides examples of how to use the `nb.exe` command line tool. The examples assume that you are running a powershell terminal.

1. **List Installed Applications**
   ```cmd
   nb.exe list -json $env:ProgramFiles\tools.json
   ```
   Lists all applications specified in the provided JSON file.

2. **Install Applications**
   ```cmd
   nb.exe install -json $env:ProgramFiles\tools.json
   ```
   Downloads and installs applications specified in the JSON file (requires admin privileges).  This checks if the application is already installed and if not it will install it.
   If the application is already installed, it will skip the installation.

3. **Display Git Information**
   ```cmd
   nb.exe git_info
   ```
   Displays the current Git branch and tag information for the local repository.

4. **Run a Build Target**
   ```cmd
   nb.exe stage -v true
   ```
   Runs the `stage` target defined in the nbuild.targets file with verbose output enabled.

5. **List nbuild targets**
   ```cmd
   nb.exe targets
   ```
   Lists all available build targets defined in the nbuild.targets file and saves them in the targets.md file.

6. **Set a Specific Git Tag**
   ```cmd
   nb.exe git_settag -tag 1.0.0
   ```
   Sets the specified Git tag (`1.0.0`) in the local repository.

7. **Automatically Set the Next Git Tag**
   ```cmd
   nb.exe git_autotag -buildtype stage
   ```
   Automatically generates and sets the next Git tag based on the specified build type (`stage` or `prod`).

8. **Push the Next Git Tag to Remote**
   ```cmd
   nb.exe git_push_autotag -buildtype prod
   ```
   Automatically generates the next Git tag based on the specified build type (`prod`) and pushes it to the remote repository.

9. **Display the Current Git Branch**
   ```cmd
   nb.exe git_branch
   ```
   Displays the current Git branch in the local repository.

10. **Clone a Git Repository**
    ```cmd
    nb.exe git_clone -url https://github.com/example/repo.git -path C:\Projects
    ```
    Clones the specified Git repository (`https://github.com/example/repo`) into the specified path (`C:\Projects`).

---
