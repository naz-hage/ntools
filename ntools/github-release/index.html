<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="naz-hage" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Github Release - Ntools - Work in Progress</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Github Release";
        var mkdocs_page_input_path = "ntools/github-release.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Ntools - Work in Progress
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/">Practice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../setup/">Setup your project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../buildtypes/">Build Types</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../versioning/">Versioning</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">List of Tools</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../nbuild/">Nbuild (nb.exe)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lf/">lf (lf.exe)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nbackup/">Nbackup (nbackup.exe)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wi/">wi (wi.exe)</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Github Release</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#repository-requirements">Repository Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#authentication-requirements">Authentication Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#github-actions-workflow-example">GitHub Actions Workflow Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#branch-checkout-example">Branch Checkout Example</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Custom Build Tasks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../nbuildtasks/">Nbuild Tasks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../version-automation-guide/">Version Automation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ntools/">Development Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >ntools-scripts module</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../ntools-scripts-module/">Module</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ntools-scripts-module-api/">API</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Build System Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../code-coverage/">Code Coverage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nbuild-targets/">MSBuild Targets</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">atools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../atools/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >List of tools</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../atools/sdo/">SDO (Simple DevOps Operations)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../atools/sdo-installation/">SDO Installation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../atools/install-ntools/">Install NTools</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../SDO_ARCHITECTURE/">SDO Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../atools/azdo_payloads/">AzDO payloads</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Ntools - Work in Progress</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">List of Tools</li>
      <li class="breadcrumb-item active">Github Release</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/naz-hage/ntools/edit/main/docs/ntools/github-release.md">Edit on ntools</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>nb.exe is also designed to help you create and manage GitHub releases. It also enables you to download release assets, such as files named in the format x.y.z.zip. The tool expects downloaded assets to be in a zip file named ${tag}.zip, where tag must be a valid tag in the repository created by the tool (e.g., <code>x.y.z</code>).  checkout the <a href="../../versioning/">versioning</a> section for more details.</p>
<h2 id="requirements">Requirements</h2>
<h3 id="repository-requirements">Repository Requirements</h3>
<ul>
<li>The repository must have:</li>
<li>A GitHub token to create releases (required for private repos and write operations).</li>
<li>A GitHub owner to create releases (can be specified via command line).</li>
<li>A Git branch to create releases.</li>
<li>At least one Git tag prior to creating releases.</li>
</ul>
<h3 id="authentication-requirements">Authentication Requirements</h3>
<ul>
<li><strong>Public Repositories:</strong> No authentication required for read operations</li>
<li><strong>Private Repositories:</strong> Authentication required for all operations</li>
<li><strong>Write Operations:</strong> Authentication always required (create releases, upload assets)</li>
</ul>
<h3 id="github-actions-workflow-example">GitHub Actions Workflow Example</h3>
<p>Here is an example of how to set up authentication in a GitHub Actions workflow file. You can use either a personal access token or GitHub CLI authentication:</p>
<p><strong>Option 1: Personal Access Token (Recommended for CI/CD)</strong></p>
<pre><code class="language-yml">- name: Build using ntools
  run: |
    &amp; &quot;$env:ProgramFilesPath/nbuild/nb.exe&quot; ${{ env.Build_Type }} -v ${{ env.Enable_Logging }}
  shell: pwsh
  working-directory: ${{ github.workspace }}
  env:
    OWNER: ${{ github.repository_owner }}
    API_GITHUB_KEY: ${{ secrets.API_GITHUB_KEY }}
</code></pre>
<p><strong>Option 2: GitHub CLI Authentication</strong></p>
<pre><code class="language-yml">- name: Authenticate with GitHub CLI
  run: |
    gh auth login --with-token &lt;&lt;&lt; ${{ secrets.GITHUB_TOKEN }}
  shell: bash

- name: Build using ntools
  run: |
    &amp; &quot;$env:ProgramFilesPath/nbuild/nb.exe&quot; ${{ env.Build_Type }} -v ${{ env.Enable_Logging }}
  shell: pwsh
  working-directory: ${{ github.workspace }}
  env:
    OWNER: ${{ github.repository_owner }}
</code></pre>
<p>The above actions build, test, and create releases using the GitHubRelease tool and upload to GitHub.</p>
<h3 id="branch-checkout-example">Branch Checkout Example</h3>
<p>Before running the tool, you must checkout a branch. Here is an example of how to checkout a branch in a GitHub Actions workflow file:</p>
<pre><code class="language-yml">- name: Checkout Repository
  uses: actions/checkout@v4
  with:
    token: ${{ secrets.API_GITHUB_KEY }}
    fetch-depth: 0
    ref: ${{ github.event.pull_request.head.ref }}
    repository: ${{ github.event.pull_request.head.repo.full_name }}
</code></pre>
<h2 id="repository-visibility-based-authentication">Repository Visibility-Based Authentication</h2>
<p><strong>New Feature</strong>: NTools now intelligently determines when authentication is required based on repository visibility and operation type.</p>
<h3 id="how-it-works">How It Works</h3>
<ul>
<li><strong>Public Repositories:</strong></li>
<li>Read operations (listing releases, downloading assets) work without authentication</li>
<li>Write operations (creating releases, uploading assets) require authentication</li>
<li><strong>Private Repositories:</strong></li>
<li>All operations require authentication</li>
<li><strong>Unknown Visibility:</strong></li>
<li>The tool attempts to determine repository visibility via unauthenticated API calls</li>
<li>If visibility cannot be determined, authentication is required for safety</li>
</ul>
<h3 id="authentication-flow">Authentication Flow</h3>
<ol>
<li>Tool determines if the operation requires authentication based on repository visibility</li>
<li>If authentication is required, it tries available authentication methods in order:</li>
<li><code>API_GITHUB_KEY</code> environment variable</li>
<li>GitHub CLI authentication (<code>gh auth token</code>)</li>
<li>Windows Credential Manager</li>
<li>If no valid authentication is found, clear error messages guide users to set up authentication</li>
</ol>
<h3 id="benefits">Benefits</h3>
<ul>
<li><strong>Simplified Usage:</strong> Public repositories work without any authentication setup</li>
<li><strong>Security:</strong> Private repositories still require proper authentication</li>
<li><strong>Flexibility:</strong> Multiple authentication methods supported</li>
<li><strong>User-Friendly:</strong> Clear error messages when authentication is needed</li>
</ul>
<h3 id="stage-release">Stage Release</h3>
<ul>
<li>When <code>nb stage</code> runs successfully:</li>
<li>The tool creates a stage release tagged with the next stage release number.</li>
<li>The release notes include the commits since the last stage or production tag.</li>
<li>The API token from the repository secrets is used to create this release.</li>
<li>The release package is uploaded to the release.</li>
</ul>
<h3 id="production-release">Production Release</h3>
<ul>
<li>When <code>nb prod</code> runs successfully:</li>
<li>The tool creates a production release tagged with the next production release number.</li>
<li>The release notes include the commits since the last production tag.</li>
<li>All previous stage releases are deleted.</li>
<li>The API token from the repository secrets is used to create this release.</li>
<li>The release package is uploaded to the release.</li>
</ul>
<h2 id="create-a-github-token">Create a GitHub Token</h2>
<p>Follow the <a href="https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token">GitHub documentation</a> to create a GitHub token.</p>
<h3 id="required-permissions">Required Permissions</h3>
<p>The access token must have the following permissions:</p>
<table>
<thead>
<tr>
<th><strong>Permission Type</strong></th>
<th><strong>Scope</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Repository</td>
<td>Contents: <code>Read/Write</code></td>
<td>Access repository contents.</td>
</tr>
<tr>
<td></td>
<td>Metadata: <code>Read-only</code></td>
<td>Access repository metadata.</td>
</tr>
<tr>
<td></td>
<td>Actions: <code>Read/Write</code></td>
<td>Manage GitHub Actions (if needed).</td>
</tr>
<tr>
<td></td>
<td>Packages: <code>Read/Write</code></td>
<td>Manage GitHub Packages (if needed).</td>
</tr>
<tr>
<td>Workflow</td>
<td>Workflows: <code>Read/Write</code></td>
<td>Manage workflows (if needed).</td>
</tr>
<tr>
<td>Release</td>
<td>Releases: <code>Read/Write</code></td>
<td>Manage GitHub releases.</td>
</tr>
</tbody>
</table>
<h2 id="githubrelease-command-line-options">GitHubRelease Command Line Options</h2>
<h3 id="usage">Usage</h3>
<p>See <a href="../nbuild/">nb.exe</a> for the command line options.</p>
<h2 id="manifests-and-private-github-release-assets">Manifests and private GitHub release assets</h2>
<ul>
<li><code>nb download</code> and <code>nb install</code> can consume JSON manifests that reference GitHub release assets (for example <code>WebDownloadFile</code> entries that point at <code>https://github.com/OWNER/REPO/releases/download/TAG/asset.zip</code>).</li>
<li>For private repositories, unauthenticated requests to the public <code>releases/download</code> URL will return 404. <code>nb</code> will attempt an authenticated fallback using the GitHub API when a token is available.</li>
</ul>
<p>How authentication is provided
- <strong>Multiple authentication methods supported</strong> (tried in order of preference):
  1. <code>API_GITHUB_KEY</code> environment variable
  2. GitHub CLI authentication (<code>gh auth token</code>)
  3. Windows Credential Manager (<code>GitHubRelease</code>/<code>API_GITHUB_KEY</code>)
- <strong>For private repositories:</strong> Authentication is required for all operations
- <strong>For public repositories:</strong> Authentication is only required for write operations (creating releases)
- <strong>GitHub CLI Setup:</strong>
  ```bash
  # Install GitHub CLI if not already installed
  winget install --id GitHub.cli</p>
<p># Authenticate with GitHub
  gh auth login
  <code>- **Environment Variable Setup:**</code>powershell
  $env:API_GITHUB_KEY = 'ghp_XXXX'
  .\Release\nb.exe install --json private-repo.json --verbose
  ```</p>
<p>Behavior
- On download failure (404) for a GitHub release URL, <code>nb</code> will parse the owner/repo/tag and call into <code>GitHubRelease.ReleaseService.DownloadAssetByName(tag, assetName, dest)</code> which uses the GitHub API to find the asset and download it using the authenticated asset endpoint. This approach supports private repositories when the token has appropriate scopes (typically <code>repo</code> and <code>releases</code>).</p>
<p>Notes and troubleshooting
- <strong>Authentication Methods:</strong> The tool supports multiple authentication methods. If one method fails, it will try the next available method.
- <strong>Token Scopes:</strong> Ensure your authentication method has appropriate scopes:
  - For private repositories: <code>repo</code> scope (includes releases access)
  - For public repositories: <code>public_repo</code> scope for write operations
- <strong>GitHub CLI:</strong> If using <code>gh auth login</code>, ensure the token has the correct scopes by running <code>gh auth status</code> to verify.
- <strong>Environment Variables:</strong> The <code>API_GITHUB_KEY</code> takes precedence over other methods when set.
- <strong>For enterprise GitHub installations with custom hosts:</strong> The <code>GitHubRelease</code> helpers must be configured to use the appropriate API base URL.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../wi/" class="btn btn-neutral float-left" title="wi (wi.exe)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../nbuildtasks/" class="btn btn-neutral float-right" title="Nbuild Tasks">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/naz-hage/ntools" class="fa fa-code-fork" style="color: #fcfcfc"> ntools</a>
        </span>
    
    
      <span><a href="../wi/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../nbuildtasks/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
